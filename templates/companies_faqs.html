{% extends "base.html" %}
{% load static %}
{% block title %}FAQs{% endblock %}
{% block main_class %}w-full{% endblock %}
{% block content %}
<section class="relative overflow-hidden rounded-none text-white mb-8">
  <div class="relative z-10 grid md:grid-cols-2 gap-6 px-6 sm:px-10 lg:px-14 py-10 bg-blue-50/60 items-center">
    <div>
      {% if last_updated %}<div class="text-sm text-gray-600 mb-2">Last updated: {{ last_updated|date:"F d, Y" }}</div>{% endif %}
      <h1 class="text-4xl sm:text-5xl font-extrabold text-[#0F3C7A]">Auto Insurance Frequently Asked Questions</h1>
      <p class="mt-3 max-w-2xl text-gray-700">Everything you’ve wanted to know and more</p>
      <div class="mt-4 flex items-center gap-2 text-gray-700">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h10M4 18h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        <span class="text-sm">Get quotes from providers in your area</span>
      </div>
      <form method="post" action="{% url 'contact' %}" class="mt-3 grid grid-cols-[1fr_auto] gap-0 max-w-md">
        {% csrf_token %}
        <input name="message" class="rounded-none px-3 py-2 text-sm text-gray-900 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="38000">
        <button class="btn btn-primary btn-sm rounded-none">Get Started</button>
        <input type="hidden" name="name" value="FAQ Zip">
        <input type="hidden" name="email" value="zip@example.com">
      </form>
    </div>
    <div class="hidden md:block">
      <img src="{% static 'images/car-insurance-reviews.webp' %}" loading="eager" class="rounded-none w-full max-w-[720px] aspect-[16/10] object-contain ml-auto" alt="FAQs">
    </div>
  </div>
  </section>
  <section class="rounded-none bg-white">
    <div class="px-6 sm:px-10 lg:px-14 py-10">
      <div class="grid lg:grid-cols-4 gap-8">
        <div class="lg:col-span-3">
          {% for c in categories %}
          <h2 id="cat-{{ c.slug }}" class="text-2xl font-extrabold text-[#0F3C7A] mb-4">{{ c.name }}</h2>
          <div class="grid gap-3">
            {% for p in c.posts.all %}
            {% if p.is_active %}
            <a href="{% url 'faq_post_detail' p.slug %}" class="text-blue-700 hover:underline">{{ p.title }}</a>
            {% endif %}
            {% endfor %}
          </div>
          <div class="my-8"></div>
          {% endfor %}
        </div>
        <aside>
          <div class="rounded-none border border-blue-200 bg-blue-50/60 p-4 sticky top-24">
            <div class="flex items-center gap-2 text-sm font-semibold text-[#0F3C7A]">
              <span class="inline-flex h-6 w-6 items-center justify-center rounded-full bg-white text-[#0F3C7A]">☰</span>
              On this page
            </div>
            <div id="toc" class="mt-2 grid gap-1">
              {% for c in categories %}
              <a href="#cat-{{ c.slug }}" class="text-sm text-gray-700 hover:text-blue-700 border-l-2 border-transparent pl-3">{{ c.name }}</a>
              {% endfor %}
            </div>
          </div>
        </aside>
      </div>
    </div>
  </section>
  <script>
    document.addEventListener('DOMContentLoaded',function(){
      const links = Array.from(document.querySelectorAll('#toc a'));
      links.forEach(a=>a.addEventListener('click',e=>{
        e.preventDefault();
        const id = a.getAttribute('href').slice(1);
        const el = document.getElementById(id);
        if (el) el.scrollIntoView({behavior:'smooth', block:'start'});
      }));
      const map = new Map(links.map(a=>[a.getAttribute('href').slice(1), a]));
      const io = new IntersectionObserver(entries=>{
        entries.forEach(entry=>{
          const id = entry.target.id;
          const link = map.get(id);
          if (!link) return;
          if (entry.isIntersecting) {
            links.forEach(l=>l.classList.remove('text-blue-700','font-semibold'));
            link.classList.add('text-blue-700','font-semibold');
          }
        });
      },{rootMargin:'-20% 0px -70% 0px', threshold:0});
      document.querySelectorAll('h2[id^="cat-"]').forEach(h=>io.observe(h));
    });
  </script>
{% endblock %}
